<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Bookshelf — Arun Baburaj</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="/favicon.png" type="image/png">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#dbe2eb;--text:#111219;--muted:#5b6066;--max-width:640px;--nav-gap:28px}
    *{box-sizing:border-box;margin:0;padding:0}
    body{background:var(--bg);font-family:Inter,-apple-system,system-ui,"Segoe UI",Roboto,"Helvetica Neue",Arial;color:var(--text);}
    .page-top-border{height:3px;background:rgba(0,0,0,0.08);}
    header{display:flex;justify-content:center;border-bottom:1px solid rgba(0,0,0,0.06);background:transparent;width:100%;}
    .nav{max-width: var(--max-width);width:100%;display:flex;justify-content:flex-start;padding:20px 16px;gap: var(--nav-gap);font-size:15px;font-weight:600;color:var(--muted);margin: 0 auto;}
    .nav a{color:var(--muted);text-decoration:none;padding-bottom:2px;border-bottom:2px solid transparent}
    .nav a:hover{border-bottom-color:var(--text);color:var(--text)}
    .nav a.active{color:var(--text);border-bottom-color:var(--text);}
    main{max-width:var(--max-width);margin:48px auto;padding:0 16px}
    .page-title{font-weight:700;font-size:18px;margin-bottom:18px}

    /* 3-row bookshelf grid */
    .books-wrapper { width:100%; margin-top:8px; }
    .books-grid {
      display: grid;
      grid-auto-flow: column;
      grid-auto-columns: 240px;
      grid-template-rows: repeat(3, auto);
      gap: 18px;
      align-items: start;
      padding-bottom: 12px;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    .book-card {
      display:flex;
      gap:12px;
      align-items:flex-start;
      background: rgba(255,255,255,0.03);
      padding:12px;
      border-radius:8px;
      border:1px solid rgba(0,0,0,0.04);
      min-width: 220px;
    }

    .book-cover {
      width:100px;
      height:150px;
      object-fit:cover;
      border-radius:6px;
      background:#eaeef6;
      flex-shrink:0;
    }

    .book-meta { display:flex;flex-direction:column; }
    .book-title { font-weight:700; margin-bottom:6px; font-size:15px; line-height:1.2; }
    .book-author { color:var(--muted); font-size:13px; }

    .book-count{margin-top:12px;color:var(--muted);font-size:13px}

    /* responsive adjustments */
    @media (max-width:920px) {
      .books-grid { grid-auto-columns: 200px; }
      .book-cover { width:90px; height:135px; }
    }
    @media (max-width:700px) {
      .books-grid { grid-auto-columns: 160px; }
      .book-cover { width:80px; height:120px; }
    }

    /* social icons */
    .social-fixed{position:fixed;bottom:28px;left:50%;transform:translateX(-50%);display:flex;gap:28px;opacity:0.95;z-index:40;}
    .social-fixed a{color:var(--text);text-decoration:none} .social-fixed a:hover{opacity:0.7}
  </style>
</head>
<body>
  <div class="page-top-border"></div>
  <header>
    <nav class="nav">
      <a href="/">Index</a>
      <a href="/portfolio">Portfolio</a>
      <a href="/bookshelf" class="active">Bookshelf</a>
      <a href="/principles">Principles</a>
    </nav>
  </header>

  <main>
    <div class="page-title">Bookshelf</div>

    <div class="books-wrapper">
      <div id="books-grid" class="books-grid" aria-live="polite">
        <!-- cards injected here -->
      </div>
    </div>

    <div id="book-count" class="book-count" aria-live="polite"></div>
  </main>

  <div class="social-fixed">
    <a href="https://www.linkedin.com/in/arunbaburaj" target="_blank" aria-label="LinkedIn">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M4.98 3.5C4.98 4.88 3.86 6 2.5 6S0 4.88 0 3.5 1.12 1 2.5 1s2.48 1.12 2.48 2.5zM.5 8h4V24h-4V8zm7.98 0h3.83v2.16h.05c.53-1 1.84-2.16 3.79-2.16 4.05 0 4.8 2.67 4.8 6.14V24h-4v-8.16c0-1.95-.03-4.45-2.71-4.45-2.71 0-3.13 2.12-3.13 4.31V24h-4V8z"/></svg>
    </a>
    <a href="https://x.com/96Arun" target="_blank" aria-label="X">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2h3.314l-7.26 8.3L24 22h-6.828l-5.343-7.027L5.463 22H2.148l7.78-8.888L0 2h6.828l4.973 6.533L18.244 2zm-1.157 18h1.843L7.08 4h-1.89l11.897 16z"/></svg>
    </a>
    <a href="mailto:arunbaburajc@gmail.com" aria-label="Email">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4-8 5-8-5V6l8 5 8-5v2z"/></svg>
    </a>
  </div>

  <script>
  /************************************************************************
   * EMBEDDED CSV OPTION (preferred for immediate preview)
   *
   * Paste your CSV content between the backticks in EMBED_CSV below.
   * Example header rows in your CSV: "title,author,isbn,status"
   *
   * If EMBED_CSV is empty, the script will try fetch() on these paths:
   *   1) /mnt/data/books.csv (sandbox preview if available)
   *   2) /data/books.csv (production; upload there on GitHub)
   *   3) /books.csv (alternate)
   ************************************************************************/

  // --- Paste your CSV contents here (between the backticks) ---
  const EMBED_CSV = `
`; // <-- put CSV content here, between the backticks

  // production/sandbox fallback paths (kept just in case)
  const CSV_CANDIDATES = [
    '/mnt/data/books.csv', // sandbox path (if you uploaded here)
    '/data/books.csv',     // recommended production path on your repo
    '/books.csv'           // alternate
  ];

  // CSV parser (robust, supports quoted fields)
  function parseCSV(text){
    const rows = [];
    let cur = '', row = [], inQuotes = false;
    for(let i=0;i<text.length;i++){
      const ch = text[i], nxt = text[i+1];
      if(ch === '"'){
        if(inQuotes && nxt === '"'){ cur += '"'; i++; continue; }
        inQuotes = !inQuotes; continue;
      }
      if(ch === ',' && !inQuotes){ row.push(cur); cur = ''; continue; }
      if((ch === '\n' || ch === '\r') && !inQuotes){
        if(ch === '\r' && text[i+1] === '\n') i++;
        row.push(cur); rows.push(row); row = []; cur = ''; continue;
      }
      cur += ch;
    }
    if(cur !== '' || row.length) { row.push(cur); rows.push(row); }
    if(rows.length && rows[rows.length-1].length === 1 && rows[rows.length-1][0] === '') rows.pop();
    return rows;
  }

  function normalizeHeader(h){ return String(h||'').trim().toLowerCase().replace(/[^a-z0-9]+/g,'_'); }
  function sanitizeIsbn(s){ if(!s) return ''; s = String(s).trim().replace(/[^0-9Xx]/g,''); if(!s || s.toLowerCase() === 'nan') return ''; return s; }

  // convert rows->objects
  function rowsToObjects(rows){
    if(!rows || rows.length < 1) return [];
    const headers = rows[0].map(normalizeHeader);
    const objs = [];
    for(let r=1;r<rows.length;r++){
      const row = rows[r];
      if(row.every(c => String(c||'').trim() === '')) continue;
      const obj = {};
      for(let c=0;c<headers.length;c++){
        obj[headers[c]] = row[c] !== undefined ? row[c].trim() : '';
      }
      objs.push(obj);
    }
    return objs;
  }

  // loader: prefer EMBED_CSV, else try fetch candidates
  async function loadBooks(){
    if(EMBED_CSV && EMBED_CSV.trim().length > 0){
      try{
        const rows = parseCSV(EMBED_CSV);
        return rowsToObjects(rows);
      }catch(e){
        console.error('Failed to parse EMBED_CSV', e);
      }
    }

    for(const url of CSV_CANDIDATES){
      try{
        const res = await fetch(url, {cache:'no-store'});
        if(!res.ok) { console.warn('CSV not found at', url, res.status); continue; }
        const txt = await res.text();
        const rows = parseCSV(txt);
        return rowsToObjects(rows);
      }catch(err){
        console.warn('Failed to fetch/parse CSV', url, err);
        continue;
      }
    }
    return null;
  }

  // create DOM card
  function createBookCard(item){
    const title = item.title || item.book || item.name || 'Untitled';
    const author = item.author || item.authors || item.writer || '';
    const isbn = sanitizeIsbn(item.isbn || item.isbn13 || item.isbn10 || '');
    const cover = isbn ? `https://covers.openlibrary.org/b/isbn/${isbn}-M.jpg` : '';

    const card = document.createElement('div'); card.className = 'book-card';
    const img = document.createElement('img'); img.className = 'book-cover'; img.alt = title + ' cover';
    if(cover){ img.src = cover; img.onerror = ()=>{ img.src=''; img.style.background='#e9edf3'; img.alt='No cover'; } }
    const meta = document.createElement('div'); meta.className = 'book-meta';
    const t = document.createElement('div'); t.className = 'book-title'; t.textContent = title;
    const a = document.createElement('div'); a.className = 'book-author'; a.textContent = author;
    meta.appendChild(t); if(author) meta.appendChild(a);
    card.appendChild(img); card.appendChild(meta);
    return card;
  }

  // init
  (async function init(){
    const grid = document.getElementById('books-grid');
    const countEl = document.getElementById('book-count');
    grid.innerHTML = 'Loading…';
    const data = await loadBooks();
    if(!data || data.length === 0){
      grid.innerHTML = '<div style="padding:12px;color:var(--muted)">No books found. To preview, paste your CSV into the EMBED_CSV variable inside the HTML, or upload <code>/data/books.csv</code> to your repo.</div>';
      countEl.textContent = '';
      return;
    }
    grid.innerHTML = '';
    const mapped = data.map(row => ({
      title: row.title || row.book || row.name || '',
      author: row.author || row.authors || row.writer || '',
      isbn: row.isbn || row.isbn13 || row.isbn10 || ''
    }));
    mapped.forEach(item => grid.appendChild(createBookCard(item)));
    countEl.textContent = `${mapped.length} book${mapped.length>1?'s':''}`;
  })();
  </script>
</body>
</html>
