<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Bookshelf — Arun Baburaj</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" href="/favicon.png" type="image/png">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#dbe2eb;
      --text:#111219;
      --muted:#5b6066;
      --card-bg: rgba(255,255,255,0.03);
      --header-max-width:640px;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      background:var(--bg);
      font-family:Inter,-apple-system,system-ui,"Segoe UI",Roboto,"Helvetica Neue",Arial;
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    .page-top-border{height:3px;background:rgba(0,0,0,0.08);}

    /* header/nav */
    header{
      display:flex;
      justify-content:center;
      border-bottom:1px solid rgba(0,0,0,0.06);
      background:transparent;
      width:100%;
      position:relative;
      z-index:40;
    }
    .nav{
      max-width:var(--header-max-width);
      width:100%;
      display:flex;
      justify-content:flex-start;
      padding:20px 16px;
      gap:28px;
      font-size:15px;
      font-weight:600;
      color:var(--muted);
      margin:0 auto;
    }
    .nav a{color:var(--muted);text-decoration:none;padding-bottom:4px;border-bottom:2px solid transparent}
    .nav a:hover{border-bottom-color:var(--text);color:var(--text)}
    .nav a.active{color:var(--text);border-bottom-color:var(--text)}

    /* main */
    main{
      width:100%;
      margin:48px auto;
      padding:0 24px;
    }
    .page-title{
      font-weight:700;
      font-size:18px;
      margin:0 auto 18px;
      max-width:var(--header-max-width);
      padding:0 16px;
    }

    /* grid (covers-only) */
    .books-grid{
      width:100%;
      max-width:none;
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
      gap:18px;
      align-items:start;
      padding: 0 8px 48px;
      justify-items:center;
    }

    .book-card{
      width:160px;
      display:flex;
      justify-content:center;
      align-items:center;
      border-radius:8px;
      overflow:hidden;
      transition: transform .12s ease, box-shadow .12s ease;
      background:transparent;
      padding:6px;
    }
    .book-card:hover{ transform: translateY(-6px); box-shadow: 0 12px 24px rgba(16,24,40,0.08); }

    .cover-wrap{
      width:150px;
      height:220px;
      border-radius:6px;
      overflow:hidden;
      display:block;
      background:#e9edf6;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .book-cover{ width:100%; height:100%; object-fit:cover; display:block; }

    /* responsive */
    @media (max-width:920px){
      .books-grid{ grid-template-columns:repeat(auto-fill,minmax(140px,1fr)); gap:14px; }
      .cover-wrap{ width:130px; height:190px; }
      .book-card{ width:130px; }
    }
    @media (max-width:560px){
      .books-grid{ grid-template-columns:repeat(auto-fill,minmax(120px,1fr)); gap:12px; }
      .cover-wrap{ width:120px; height:175px; }
      .book-card{ width:120px; }
    }

    /* small note and count */
    .book-count{max-width:var(--header-max-width);margin:10px auto;color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <div class="page-top-border"></div>

  <header>
    <nav class="nav" aria-label="Main navigation">
      <a href="/">Index</a>
      <a href="/portfolio">Portfolio</a>
      <a href="/bookshelf" class="active">Bookshelf</a>
      <a href="/principles">Principles</a>
    </nav>
  </header>

  <main>
    <div class="page-title">Bookshelf</div>

    <div id="books-grid" class="books-grid" aria-live="polite">
      <!-- Covers will be injected here -->
    </div>

    <div id="book-count" class="book-count" aria-live="polite"></div>
  </main>

  <div style="position:fixed;bottom:28px;left:50%;transform:translateX(-50%);display:flex;gap:24px;z-index:40">
    <a href="https://www.linkedin.com/in/arunbaburaj" target="_blank" aria-label="LinkedIn" style="color:var(--text);text-decoration:none">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M4.98 3.5C4.98 4.88 3.86 6 2.5 6S0 4.88 0 3.5 1.12 1 2.5 1s2.48 1.12 2.48 2.5zM.5 8h4V24h-4V8zm7.98 0h3.83v2.16h.05c.53-1 1.84-2.16 3.79-2.16 4.05 0 4.8 2.67 4.8 6.14V24h-4v-8.16c0-1.95-.03-4.45-2.71-4.45-2.71 0-3.13 2.12-3.13 4.31V24h-4V8z"/></svg>
    </a>
    <a href="https://x.com/96Arun" target="_blank" aria-label="X" style="color:var(--text);text-decoration:none">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2h3.314l-7.26 8.3L24 22h-6.828l-5.343-7.027L5.463 22H2.148l7.78-8.888L0 2h6.828l4.973 6.533L18.244 2zm-1.157 18h1.843L7.08 4h-1.89l11.897 16z"/></svg>
    </a>
    <a href="mailto:arunbaburajc@gmail.com" aria-label="Email" style="color:var(--text);text-decoration:none">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4-8 5-8-5V6l8 5 8-5v2z"/></svg>
    </a>
  </div>

  <script>
  /* CSV candidates (adjust if your site uses a different path) */
  const CSV_CANDIDATES = [
    '/mnt/data/books.csv',
    '/data/books.csv',
    '/books.csv'
  ];

  // Simple CSV parser (supports quoted fields)
  function parseCSV(text){
    const rows = [];
    let cur = '', row = [], inQuotes = false;
    for(let i=0;i<text.length;i++){
      const ch = text[i], nxt = text[i+1];
      if(ch === '"'){
        if(inQuotes && nxt === '"'){ cur += '"'; i++; continue; }
        inQuotes = !inQuotes; continue;
      }
      if(ch === ',' && !inQuotes){ row.push(cur); cur=''; continue; }
      if((ch === '\n' || ch === '\r') && !inQuotes){
        if(ch === '\r' && text[i+1] === '\n') i++;
        row.push(cur); rows.push(row); row=[]; cur=''; continue;
      }
      cur += ch;
    }
    if(cur !== '' || row.length){ row.push(cur); rows.push(row); }
    if(rows.length && rows[rows.length-1].length === 1 && rows[rows.length-1][0] === '') rows.pop();
    return rows;
  }

  function normalizeHeader(h){ return String(h||'').trim().toLowerCase().replace(/[^a-z0-9]+/g,'_'); }
  function sanitizeIsbn(s){ if(!s) return ''; s = String(s||'').trim().replace(/[^0-9Xx]/g,''); if(!s || s.toLowerCase() === 'nan') return ''; return s; }

  // Fallback initials SVG placeholder
  function makeInitialsPlaceholder(text, w=300, h=440, bg='#6B8DF6'){
    const initials = (text||' ').split(/\s+/).slice(0,2).map(s=>s.charAt(0)).join('').toUpperCase() || '?';
    const fontSize = Math.round(Math.min(w,h) / 3.2);
    const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='${w}' height='${h}'><rect width='100%' height='100%' fill='${bg}'/><text x='50%' y='50%' font-family='Inter, Arial, sans-serif' font-size='${fontSize}' fill='white' text-anchor='middle' dominant-baseline='middle'>${initials}</text></svg>`;
    return 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(svg);
  }

  function createCoverCard(item, idx){
    const title = (item.title || '').trim() || 'Unknown title';
    const isbn10 = sanitizeIsbn(item.isbn10 || '');
    const isbn13 = sanitizeIsbn(item.isbn13 || '');
    const isbn = isbn13 || isbn10 || '';

    const card = document.createElement('div');
    card.className = 'book-card';

    const coverWrap = document.createElement('div');
    coverWrap.className = 'cover-wrap';

    const img = document.createElement('img');
    img.className = 'book-cover';
    img.alt = title + ' cover';
    img.title = title; // native tooltip on hover

    // Attempt to use cover_url from CSV if present
    let cover = (item.cover_url || '').trim();

    // fallback: OpenLibrary by ISBN
    if(!cover && isbn){
      cover = `https://covers.openlibrary.org/b/isbn/${isbn}-M.jpg`;
    }

    if(cover){
      img.src = cover;
      img.onerror = () => { img.src = makeInitialsPlaceholder(title, 300, 440, '#6B8DF6'); };
    } else {
      img.src = makeInitialsPlaceholder(title, 300, 440, '#6B8DF6');
    }

    coverWrap.appendChild(img);
    card.appendChild(coverWrap);

    return card;
  }

  async function loadCsvCandidates(){
    for(const url of CSV_CANDIDATES){
      try{
        const res = await fetch(url, {cache:'no-store'});
        if(!res.ok){ console.warn('CSV not found at', url, res.status); continue; }
        const txt = await res.text();
        const rows = parseCSV(txt);
        if(!rows || rows.length < 1) continue;
        const headers = rows[0].map(normalizeHeader);
        const objs = [];
        for(let r = 1; r < rows.length; r++){
          const row = rows[r];
          if(row.every(c => String(c||'').trim() === '')) continue;
          const obj = {};
          for(let c = 0; c < headers.length; c++){
            obj[headers[c]] = row[c] !== undefined ? row[c].trim() : '';
          }
          objs.push(obj);
        }
        return objs;
      }catch(err){
        console.warn('Failed to fetch/parse CSV', url, err);
        continue;
      }
    }
    return null;
  }

  (async function init(){
    const grid = document.getElementById('books-grid');
    const countEl = document.getElementById('book-count');
    grid.innerHTML = 'Loading…';
    const data = await loadCsvCandidates();
    if(!data || data.length === 0){
      grid.innerHTML = '<div style="padding:12px;color:var(--muted)">No books found. Upload your CSV (books.csv) to your repo under /data or ensure the sandbox path is correct for preview.</div>';
      countEl.textContent = '';
      return;
    }

    grid.innerHTML = '';
    const mapped = data.map((row) => ({
      title: row.title || row.book || row.name || '',
      isbn10: row.isbn10 || row.isbn_10 || row.isbn_10_clean || '',
      isbn13: row.isbn13 || row.isbn_13 || row.isbn_13_clean || '',
      cover_url: row.cover_url || row.cover || ''
    }));

    mapped.forEach((item, i) => {
      const card = createCoverCard(item, i);
      grid.appendChild(card);
    });

    countEl.textContent = `${mapped.length} book${mapped.length>1?'s':''}`;
  })();
  </script>
</body>
</html>
